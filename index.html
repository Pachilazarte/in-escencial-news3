<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OSPAIL | Registro de Prestaciones Médicas</title>

  <style>
    /* =========================================================
       OSPA – ESTILO INSTITUCIONAL (REEMPLAZO DE MARCA)
       1) Pegá acá el LOGO con link directo .png/.jpg (no álbum)
       2) Reemplazá los 4 colores por los del logo (HEX)
       ========================================================= */

    :root{
      /* === COLORES DE MARCA (CAMBIAR POR LOS DEL LOGO) === */
      --brand-primario:   #2F5D50;  /* color principal del logo */
      --brand-secundario: #5E8F7B;  /* segundo color del logo */
      --brand-fondo:      #EAF5EF;  /* verde pastel muy claro (fondo) */
      --brand-neutro:     #121212;  /* negro/gris del logo */

      /* === SISTEMA === */
      --blanco: #FFFFFF;
      --borde: rgba(18,18,18,.14);
      --sombra: 0 10px 30px rgba(0,0,0,.06);
      --radius: 14px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--brand-fondo);
      color: var(--brand-neutro);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 24px;
    }

    .topbar{
      display:flex;
      align-items:center;
      gap:18px;
      padding: 14px 16px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.72);
      border: 1px solid var(--borde);
      box-shadow: var(--sombra);
      backdrop-filter: blur(6px);
      margin-bottom: 18px;
    }

    .logo{
      max-width: 170px;
      height: auto;
      object-fit: contain;
      display:block;
    }

    .titlebox h1{
      margin:0;
      font-size: 20px;
      color: var(--brand-primario);
      line-height: 1.15;
    }
    .titlebox p{
      margin: 6px 0 0;
      font-size: 13px;
      color: rgba(18,18,18,.72);
    }

    .card{
      background: var(--blanco);
      border: 1px solid var(--borde);
      border-radius: var(--radius);
      box-shadow: var(--sombra);
      padding: 22px;
    }

    .section{
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px dashed rgba(18,18,18,.18);
    }
    .section:first-child{
      margin-top:0;
      padding-top:0;
      border-top:none;
    }

    .section-title{
      display:flex;
      align-items:center;
      gap:10px;
      margin: 0 0 12px;
      font-size: 14px;
      font-weight: 800;
      color: var(--brand-primario);
    }
    .section-title:before{
      content:"";
      width: 10px;
      height: 20px;
      border-radius: 999px;
      background: var(--brand-secundario);
      display:inline-block;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px;
    }

    label{
      display:block;
      font-size: 12px;
      font-weight: 700;
      margin: 0 0 6px;
      color: rgba(18,18,18,.86);
    }

    input, select, textarea{
      width:100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(18,18,18,.18);
      background: #fff;
      font-size: 14px;
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
    }

    input:focus, select:focus, textarea:focus{
      border-color: rgba(47,93,80,.45);
      box-shadow: 0 0 0 4px rgba(94,143,123,.18);
    }

    textarea{ min-height: 92px; resize: vertical; }

    .row-actions{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top: 18px;
      align-items:center;
    }

    button{
      appearance:none;
      border:none;
      border-radius: 12px;
      padding: 12px 18px;
      font-size: 14px;
      font-weight: 800;
      cursor:pointer;
      background: var(--brand-primario);
      color: #fff;
      transition: transform .05s ease, opacity .15s ease;
    }
    button:hover{ opacity:.92; }
    button:active{ transform: translateY(1px); }

    .btn-ghost{
      background: transparent;
      color: var(--brand-primario);
      border: 1px solid rgba(47,93,80,.35);
    }

    .status{
      font-size: 13px;
      font-weight: 700;
      color: rgba(18,18,18,.75);
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(18,18,18,.10);
      background: rgba(255,255,255,.70);
      min-width: 260px;
      flex: 1;
    }

    .note{
      margin-top: 14px;
      font-size: 12px;
      color: rgba(18,18,18,.66);
      line-height: 1.35;
    }

    .small{
      font-size: 12px;
      color: rgba(18,18,18,.70);
    }
  </style>
</head>

<body>
  <div class="wrap">

<div class="topbar" style="background: #fff; justify-content: space-between; gap: 10px;">

  <div class="titlebox" style="text-align: center; flex: 1;">
    <h1 style="font-size: 20px; color: var(--brand-primario); margin: 0;">Registro de Prestaciones Médicas</h1>
    <p style="font-size: 11px; margin: 2px 0 0;">Gestión de Auditoría OSPA</p>
  </div>

  <img
    class="logo"
    src="https://i.imgur.com/9YBLfLx.jpeg" 
    alt="Logo Institucional"
    style="max-width: 120px; background: #fff; padding: 5px; border-radius: 8px;"
    onerror="this.style.display='none';"
  />

      <div id="logoError" class="small" style="display:none; position: absolute; bottom: -20px;">
        Error al cargar logos.
      </div>
    </div>

    <div class="card">
      <div class="section">
        <div class="section-title">Datos de la prestación</div>

        <div class="grid">
          <div>
            <label>Fecha y hora de carga (automático)</label>
            <input id="ts" type="text" readonly />
          </div>

          <div>
            <label>Fecha de atención</label>
            <input id="fecha_atencion" type="date" required />
          </div>

          <div>
            <label>Hora de atención</label>
            <input id="hora_atencion" type="time" required />
          </div>

          <div>
            <label>Día</label>
            <select id="dia">
              <option value=""></option>
              <option>Lunes</option><option>Martes</option><option>Miércoles</option>
              <option>Jueves</option><option>Viernes</option><option>Sábado</option><option>Domingo</option>
            </select>
          </div>

          <div>
            <label>Tipo de atención</label>
            <select id="tipo_atencion">
              <option value=""></option>
              <option>Consultorio</option>
              <option>Guardia</option>
              <option>Urgencia</option>
            </select>
          </div>

          <div>
            <label>Consultorio / Guardia (detalle)</label>
            <input id="consultorio" type="text" placeholder="Ej: Yegoyen / Pichanal / Consultorio 2" />
          </div>
        </div>
      </div>

      <!-- ===================== MÉDICO TRATANTE ===================== -->
      <div class="section">
        <div class="section-title">Médico tratante</div>

        <div class="grid">
          <div>
            <label>Médico (desplegable)</label>
            <select id="medico_tratante" required>
              <option value=""></option>
              <option>LOZANO MUÑOZ MARIA E</option>
              <option>HURTADO MARCELO SAMUEL</option>
              <option>BLANCO JUAN SIMON</option>
              <option>COLQUE JAZMIN ANGELES</option>
              <option>FLORES ZOILA MONICA</option>
              <option>PEÑA ROXANA SOLEDAD</option>
              <option>SORIA BRZEZINSKI GERALDINE ANDREA</option>
              <option>CASTRO SANTIAGO MISAEL</option>
              <option>RODRIGUEZ JOSE LUIS</option>
              <option>ROMERO RICARDO JOEL</option>
              <option>LIQUIN HIPOLITO</option>
            </select>
          </div>

          <div>
            <label>Descripción de atención / perfil (breve)</label>
            <input id="perfil_atencion" type="text" placeholder="Ej: guardia, consultorio, referente, etc." />
          </div>
        </div>
      </div>

      <!-- ===================== PACIENTE ===================== -->
      <div class="section">
        <div class="section-title">Paciente</div>

        <div class="grid">
          <div>
            <label>DNI</label>
            <input id="dni" type="number" inputmode="numeric" />
          </div>

          <div>
            <label>Paciente</label>
            <input id="paciente" type="text" />
          </div>

          <div>
            <label>Patología</label>
            <input id="patologia" type="text" />
          </div>

          <div>
            <label>Celular</label>
            <input id="celular" type="tel" />
          </div>
        </div>
      </div>

      <!-- ===================== CONTROL ADMINISTRATIVO ===================== -->
      <div class="section">
        <div class="section-title">Control administrativo</div>

        <div class="grid">
          <div>
            <label>Orden presentada</label>
            <select id="orden_presentada">
              <option value=""></option>
              <option>SI</option>
              <option>NO</option>
            </select>
          </div>

          <div>
            <label>Orden pagada</label>
            <select id="orden_pagada">
              <option value=""></option>
              <option>SI</option>
              <option>NO</option>
            </select>
          </div>

          <div>
            <label>N° Orden / Comprobante (si aplica)</label>
            <input id="nro_orden" type="text" placeholder="Ej: OP-000123 / TAD / Recibo" />
          </div>

          <div>
            <label>Importe (si aplica)</label>
            <input id="importe" type="text" placeholder="Ej: 198000" />
          </div>
        </div>
      </div>

      <!-- ===================== OBSERVACIONES ===================== -->
      <div class="section">
        <div class="section-title">Observaciones</div>
        <textarea id="observaciones" placeholder="Observaciones médicas/administrativas/auditoría (duplicados, fuera de horario, falta de orden, etc.)"></textarea>
      </div>

      <!-- ===================== ACCIONES ===================== -->
      <div class="row-actions">
        <button type="button" onclick="enviarRegistro()">Guardar registro</button>
        <button type="button" class="btn-ghost" onclick="limpiarFormulario()">Limpiar</button>
        <div class="status" id="statusBox">Listo para cargar.</div>
      </div>

    </div>
  </div>

<script>
    /* =========================================================
       CONFIG: WEB APP URL
       ========================================================= */
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw_JHMR0npwxVZhRtffaRXVhg7v0HmiY9Mw1KT5OHdy3FEpq45eHD27JUxH5iq0NRya7Q/exec";

    /* =========================================================
       INIT: Timestamp de carga
       ========================================================= */
    function isoNowLocal(){
      // Genera formato YYYY-MM-DD HH:mm:ss
      const d = new Date();
      return d.toLocaleString('sv-SE'); 
    }
    document.getElementById("ts").value = isoNowLocal();

    /* =========================================================
       HELPERS
       ========================================================= */
    function setStatus(msg){
      document.getElementById("statusBox").textContent = msg;
    }

    function val(id){ return (document.getElementById(id).value || "").trim(); }

    function limpiarFormulario(){
      const ids = [
        "fecha_atencion","hora_atencion","dia","tipo_atencion","consultorio",
        "medico_tratante","perfil_atencion",
        "dni","paciente","patologia","celular",
        "orden_presentada","orden_pagada","nro_orden","importe",
        "observaciones"
      ];
      ids.forEach(i => {
        const el = document.getElementById(i);
        if(el) el.value = "";
      });
      document.getElementById("ts").value = isoNowLocal();
      setStatus("Listo para una nueva carga.");
    }

    /* =========================================================
       ENVÍO: COMPATIBLE CON TU APPS SCRIPT
       ========================================================= */
    function enviarRegistro() {
      // 1. Validaciones mínimas
      if (!val("fecha_atencion")) { setStatus("⚠️ Falta: Fecha de atención."); return; }
      if (!val("medico_tratante")){ setStatus("⚠️ Falta: Médico tratante."); return; }

      // 2. Construcción de la fila según las columnas de tu imagen
      // Orden: ts, fecha_atencion, dia, tipo_atencion, medico_tratante, perfil, consultorio, dni, paciente, patologia, celular, orden_pres, orden_pag, nro_orden, importe, observaciones
      const fila = [
        val("ts"),                // A
        val("fecha_atencion"),    // B
        val("dia"),               // C
        val("tipo_atencion"),     // D
        val("medico_tratante"),   // E
        val("perfil_atencion"),   // F
        val("consultorio"),       // G
        val("dni"),               // H
        val("paciente"),          // I
        val("patologia"),         // J
        val("celular"),           // K
        val("orden_presentada"),  // L
        val("orden_pagada"),      // M
        val("nro_orden"),         // N
        val("importe"),           // O
        val("observaciones")      // P
      ];

      // El Apps Script usa 'nombreHoja' para evitar el error de la variable 'respuestas'
      const payload = {
        nombreHoja: "respuestas", 
        fila: fila
      };

      setStatus("⏳ Enviando...");

      fetch(WEB_APP_URL, {
        method: "POST",
        mode: "no-cors", 
        cache: "no-cache",
        headers: {
          "Content-Type": "text/plain"
        },
        body: JSON.stringify(payload)
      })
      .then(() => {
        // En no-cors asumimos éxito si no hay error de red
        setStatus("✅ ¡Guardado en Google Sheets!");
        setTimeout(limpiarFormulario, 1000);
      })
      .catch((err) => {
        console.error(err);
        setStatus("❌ Error de red o permisos.");
      });
    }
</script>

</body>
</html>
